pipeline {
    agent any
    environment {
        WORKSPACE_DIR = 'D:\\jenkins\\GitJenkins'
        DEVTOOLS_DIR  = 'C:\\DevTools'
    }
	stages
    {
        stage ("Config")
        {
            steps
            {
                script
                {   
                    String startTime      = "Start at: ${new Date().format('dd/MM/yyyy HH:mm:ss')} with parameters: "
                    String Run    = (params.RUN)?' RUN':''
                    echo RUN
                }
            }
        }
	 stage ('RUN')
        {
            when{
                expression { params.RUN}
            }
            steps
            {
                dir ("${WORKSPACE_DIR}")
                {
                    script
                    {  
                        bat """
                            if not exist Y:\\ subst Y: ${DEVTOOLS_DIR}
                            pushd ${WORKSPACE_DIR}
                            call Run.bat
                            popd
                        """
                    }
                }
            }
        }
	}
    post 
    {
        success {
            mattermostSend(color: "#2A42EE", message: "Simple test message", channel: "dmlcn-test", endpoint: "https://chat.gameloft.org/hooks/4xson5ab1jbo5ycizpwpwgkime")
        }
    }
}
def getMattermostMessage()
{
	String Run    = (params.RUN)?' RUN':''
	def msgBuild = Run ''
	return msgBuild
}
def notifySuccess()
{
    colorCode = '#00FF00'
    def subject = ":dianowobble::dianowobble: SUCCESSFUL::10: Job ${env.JOB_NAME}"
    def messgeBuild = getMattermostMessage()
    def msg = "${subject} (${messgeBuild})"
    mattermostSend (color: colorCode, message: msg, channel: "dmlcn-test", endpoint: "https://chat.gameloft.org/hooks/4xson5ab1jbo5ycizpwpwgkime")
}

